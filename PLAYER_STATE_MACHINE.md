# ğŸ° Player State Machine - ××—×–×•×¨ ×—×™×™× ×©×œ ×©×—×§×Ÿ

## ××¦×‘×™× ××¤×©×¨×™×™× (States)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   waiting   â”‚ â† ××—×›×” ×‘×ª×•×¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   active    â”‚ â† ×ª×•×¨×• ×œ×©×—×§ (×™×›×•×œ ×œ×œ×—×•×¥ ×¢×œ ×”×‘××–×¨)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ (×œ×—×¥ ×¢×œ ×”×‘××–×¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  spinning   â”‚ â† ×”×’×œ×™×œ×™× ××¡×ª×•×‘×‘×™×
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ (×”×¡×™×‘×•×‘ ×”×¡×ª×™×™×)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚showing_resultâ”‚ â† ××¦×™×’ ×ª×•×¦××” (win/loss) - **××¡×•×¨ ×œ×©× ×•×ª ×¡×˜×˜×•×¡ ×›××Ÿ!**
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ (×œ×—×¥ "×”××©×š")
       â”œâ”€ ×™×© × ×¡×™×•× ×•×ª â†’ ×—×–×¨×” ×œ-active
       â””â”€ ××™×Ÿ × ×¡×™×•× ×•×ª â†’ finished
```

## ×ª×¨×—×™×©×™× (Scenarios)

### ×ª×¨×—×™×© 1: ×©×—×§×Ÿ ×¢× 3 × ×¡×™×•× ×•×ª - ×”×¤×¡×™×“ ×‘×›×•×œ×
```
1. waiting (3 attempts)
2. active (3 attempts) â† ×œ×—×¥ ×‘××–×¨
3. spinning (3 attempts)
4. showing_result: loss (2 attempts) â† ××¦×™×’ "×œ× × ×•×¨× × ×¡×• ×©×•×‘"
5. [User clicks "×”××©×š"]
6. active (2 attempts) â† ×—×•×–×¨ ×œ×ª×•×¨×•
7. spinning (2 attempts)
8. showing_result: loss (1 attempts)
9. [User clicks "×”××©×š"]
10. active (1 attempt)
11. spinning (1 attempt)
12. showing_result: loss (0 attempts)
13. [User clicks "×”××©×š"]
14. finished â†’ ×× ×•×ª×§, ×©×—×§×Ÿ ×”×‘×
```

### ×ª×¨×—×™×© 2: ×©×—×§×Ÿ ×¢× 3 × ×¡×™×•× ×•×ª - ×–×›×” ×‘×©× ×™
```
1. waiting (3 attempts)
2. active (3 attempts) â† ×œ×—×¥ ×‘××–×¨
3. spinning (3 attempts)
4. showing_result: loss (2 attempts)
5. [User clicks "×”××©×š"]
6. active (2 attempts)
7. spinning (2 attempts)
8. showing_result: win (1 attempt) â† ××¦×™×’ "×–×›×™×ª!"
9. [User clicks "×”××©×š"]
10. active (1 attempt) â† ×¢×“×™×™×Ÿ ×™×© ×œ×• × ×¡×™×•×Ÿ
11. spinning (1 attempt)
12. showing_result: loss (0 attempts)
13. [User clicks "×”××©×š"]
14. finished â†’ ×× ×•×ª×§
```

### ×ª×¨×—×™×© 3: ×–×›×™×™×” ×‘× ×¡×™×•×Ÿ ×”××—×¨×•×Ÿ
```
1. active (1 attempt)
2. spinning (1 attempt)
3. showing_result: win (0 attempts) â† ×–×›×” ×‘× ×¡×™×•×Ÿ ×”××—×¨×•×Ÿ
4. [User clicks "×”××©×š"]
5. finished â†’ ×× ×•×ª×§
```

## ×›×œ×œ×™ State Machine

### âœ… ××” ××•×ª×¨:
- **××¢×‘×¨ ××¦×‘ ×¨×§ ×‘×ª×’×•×‘×” ×œ××™×¨×•×¢ ×‘×¨×•×¨** (×œ×—×™×¦×”, ×¡×™×•× ×¡×™×‘×•×‘, ×•×›×•')
- **showing_result ×”×•× ××¦×‘ ×§×‘×•×¢** - × ×©××¨ ×¢×“ ×©×”××©×ª××© ×œ×•×—×¥ "×”××©×š"
- **×¡×¤×™×¨×ª × ×¡×™×•× ×•×ª ×™×•×¨×“×ª ×¨×§ ××—×¨×™ spinning** (×œ×¤× ×™ showing_result)

### âŒ ××” ××¡×•×¨:
- **×œ×¢×•×œ× ×œ× ×œ×©× ×•×ª ×¡×˜×˜×•×¡ ×‘×–××Ÿ showing_result** (×œ× ××•×˜×•××˜×™×ª!)
- **×œ× ×œ×§×¨×•× getNextPlayer ××•×˜×•××˜×™×ª** - ×¨×§ ××—×¨×™ "×”××©×š"
- **×œ× ×œ×”×¤×¢×™×œ ×˜×™×™××¨ ×‘×–××Ÿ showing_result**
- **×œ× ×œ×©×—×¨×¨ isSpinActive ×œ×¤× ×™ showing_result**

## ×©×“×•×ª ×‘-Firebase ×œ×©×—×§×Ÿ

```javascript
{
  name: "×©× ×”×©×—×§×Ÿ",
  status: "waiting" | "active" | "spinning" | "showing_result" | "finished",
  attemptsLeft: 3,              // × ×¡×™×•× ×•×ª ×©× ×•×ª×¨×•
  lastAction: "buzz" | null,    // ×”×¤×¢×•×œ×” ×”××—×¨×•× ×”
  lastResult: "win" | "loss" | null,  // ×”×ª×•×¦××” ×”××—×¨×•× ×”
  lastResultTime: timestamp,
  prizeDetails: {               // ×¨×§ ×× ×–×›×”
    prizeName: "...",
    prizeCode: "PRIZE_001",
    ...
  }
}
```

## ××™×¨×•×¢×™× ×•××¢×‘×¨×™ ××¦×‘×™×

| ××™×¨×•×¢ | ××¦×‘ × ×•×›×—×™ | ×¤×¢×•×œ×” | ××¦×‘ ×—×“×© |
|-------|----------|-------|---------|
| ×©×—×§×Ÿ ×”×¦×˜×¨×£ | - | ×¦×•×¨ ×©×—×§×Ÿ | `waiting` |
| ×ª×•×¨×• ×”×’×™×¢ | `waiting` | ×¢×“×›×Ÿ ×¡×˜×˜×•×¡ | `active` |
| ×œ×—×¥ ×‘××–×¨ | `active` | ×”×ª×—×œ ×¡×™×‘×•×‘, ×”×¤×—×ª × ×¡×™×•×Ÿ | `spinning` |
| ×¡×™×‘×•×‘ ×”×¡×ª×™×™× | `spinning` | ×©××•×¨ ×ª×•×¦××” | `showing_result` |
| ×œ×—×¥ "×”××©×š" + ×™×© × ×¡×™×•× ×•×ª | `showing_result` | × ×§×” ×ª×•×¦××” | `active` |
| ×œ×—×¥ "×”××©×š" + ××™×Ÿ × ×¡×™×•× ×•×ª | `showing_result` | - | `finished` |
| finished | - | ×”×¡×¨ ×©×—×§×Ÿ, ×§×¨× ×œ×‘× | - |

## Implementation Checklist

- [ ] ×”×•×¡×£ ××¦×‘ `spinning` ×•-`showing_result`
- [ ] ×”×¡×¨ ×›×œ `getNextPlayer` ××•×˜×•××˜×™
- [ ] ×”×¡×¨ ×›×œ `resetPlayerAction` ××•×˜×•××˜×™
- [ ] ×”×•×¡×£ `handleContinueButton()` - **×–×” ×”××§×•× ×”×™×—×™×“** ×œ×¢×‘×•×¨ ×-showing_result
- [ ] ××œ ×ª×©×—×¨×¨ `isSpinActive` ×¢×“ ××—×¨×™ "×”××©×š"
- [ ] ××œ ×ª×¤×¢×™×œ ×˜×™×™××¨ ×‘-showing_result
